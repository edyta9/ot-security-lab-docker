{"version":3,"sources":["core/modbus-client-core.js"],"names":["require","install","de","biancoroyal","modbus","core","client","internalDebug","internalDebugFSM","modbusSerialDebug","XStateFSM","stateLogEnabled","networkErrors","this","id","new","BREAK","STOP","broken","createMachine","FAILURE","ACTIVATE","RECONNECT","reconnecting","on","INIT","initial","OPENSERIAL","CONNECT","SWITCH","states","CLOSE","connected","QUEUE","activated","READ","WRITE","queueing","SEND","EMPTY","empty","sending","reading","writing","failed","switch","stopped","NEW","getActualUnitId","node","msg","Number","isInteger","payload","unitid","parseInt","queueUnitId","unit_id","startStateService","toggleMachine","interpret","start","checkUnitId","clientType","getLogFunction","activateSendingOnSuccess","cb","cberr","resp","activateSending","then","err","stateService","send","activateSendingOnFailure","readModbusByFunctionCodeOne","enableDeformedMessages","readCoils_deformedReadEnabled","address","quantity","coreClient","Error","message","readCoils","modbusErrorHandling","readModbusByFunctionCodeTwo","readDiscreteInputs_deformedReadEnabled","readDiscreteInputs","readModbusByFunctionCodeThree","readHoldingRegisters_deformedReadEnabled","readHoldingRegisters","closed","readModbusByFunctionCodeFour","readInputRegisters_deformedReadEnabled","readInputRegisters","sendCustomFunctionCode","sendCustomFc","fc","requestCard","responseCard","nodeLog","internalDebugLog","customModbusMessage","delayTime","_port","_client","readable","setTimeout","bufferCommands","queueLog","JSON","stringify","timeout","getTimeout","state","clientTimeout","readModbus","info","value","writeModbusByFunctionCodeFifteen","length","writeCoils","writeModbusByFunctionCodeSix","clienttype","getID","writeRegisters","writeModbus","writable","connectClient","actualServiceState","writeModbusByFunctionCodeFive","setUnitIdFromPayload","writeModbusByFunctionCodeSixteen","tcpHost","tcpPort","tcpType","writeRegister","serialPort","serialBaudrate","serialDatabits","serialStopbits","serialParity","serialType","serialAsciiResponseStartDelimiter","serialConnectionDelay","setNewNodeOptionalSettings","unitId","commandDelay","reconnectTimeout","setNewNodeSettings","toUpperCase","setNewSerialNodeSettings","connectorType","messageAllowedStates","module","exports"],"mappings":"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","file":"../../core/modbus-client-core.js","sourcesContent":["/**\n Copyright (c) since the year 2016 Klaus Landsdorf (http://plus4nodered.com/)\n All rights reserved.\n node-red-contrib-modbus\n\n @author <a href=\"mailto:klaus.landsdorf@bianco-royal.de\">Klaus Landsdorf</a> (Bianco Royal)\n */\n'use strict'\nrequire('source-map-support').install()\n\n// eslint-disable-next-line no-var\nvar de = de || { biancoroyal: { modbus: { core: { client: {} } } } } // eslint-disable-line no-use-before-define\nde.biancoroyal.modbus.core.client.internalDebug = de.biancoroyal.modbus.core.client.internalDebug || require('debug')('contribModbus:core:client') // eslint-disable-line no-use-before-define\nde.biancoroyal.modbus.core.client.internalDebugFSM = de.biancoroyal.modbus.core.client.internalDebugFSM || require('debug')('contribModbus:core:client:fsm') // eslint-disable-line no-use-before-define\nde.biancoroyal.modbus.core.client.modbusSerialDebug = de.biancoroyal.modbus.core.client.modbusSerialDebug || require('debug')('modbus-serial') // eslint-disable-line no-use-before-define\nde.biancoroyal.modbus.core.client.XStateFSM = de.biancoroyal.modbus.core.client.XStateFSM || require('@xstate/fsm') // eslint-disable-line no-use-before-define\nde.biancoroyal.modbus.core.client.stateLogEnabled = de.biancoroyal.modbus.core.client.stateLogEnabled || false // eslint-disable-line no-use-before-define\n\nde.biancoroyal.modbus.core.client.networkErrors = ['ESOCKETTIMEDOUT', 'ETIMEDOUT', 'ECONNRESET', 'ENETRESET',\n  'ECONNABORTED', 'ECONNREFUSED', 'ENETUNREACH', 'ENOTCONN',\n  'ESHUTDOWN', 'EHOSTDOWN', 'ENETDOWN', 'EWOULDBLOCK', 'EAGAIN', 'EHOSTUNREACH']\n\nde.biancoroyal.modbus.core.client.createStateMachineService = function () {\n  this.stateLogEnabled = false\n\n  return this.XStateFSM.createMachine({\n    id: 'modbus',\n    initial: 'new',\n    states: {\n      new: { on: { INIT: 'init', BREAK: 'broken', STOP: 'stopped' } },\n      broken: { on: { INIT: 'init', STOP: 'stopped', FAILURE: 'failed', ACTIVATE: 'activated', RECONNECT: 'reconnecting' } },\n      reconnecting: { on: { INIT: 'init', STOP: 'stopped' } },\n      init: { on: { OPENSERIAL: 'opened', CONNECT: 'connected', BREAK: 'broken', FAILURE: 'failed', STOP: 'stopped', SWITCH: 'switch' } },\n      opened: { on: { CONNECT: 'connected', BREAK: 'broken', FAILURE: 'failed', CLOSE: 'closed', STOP: 'stopped', SWITCH: 'switch' } },\n      connected: { on: { CLOSE: 'closed', ACTIVATE: 'activated', QUEUE: 'queueing', BREAK: 'broken', FAILURE: 'failed', STOP: 'stopped', SWITCH: 'switch' } },\n      activated: { on: { READ: 'reading', WRITE: 'writing', QUEUE: 'queueing', BREAK: 'broken', CLOSE: 'closed', FAILURE: 'failed', STOP: 'stopped', SWITCH: 'switch' } },\n      queueing: { on: { ACTIVATE: 'activated', SEND: 'sending', READ: 'reading', WRITE: 'writing', EMPTY: 'empty', BREAK: 'broken', CLOSE: 'closed', FAILURE: 'failed', STOP: 'stopped', SWITCH: 'switch' } },\n      empty: { on: { QUEUE: 'queueing', BREAK: 'broken', FAILURE: 'failed', CLOSE: 'closed', STOP: 'stopped', SWITCH: 'switch' } },\n      sending: { on: { ACTIVATE: 'activated', READ: 'reading', WRITE: 'writing', BREAK: 'broken', FAILURE: 'failed', STOP: 'stopped', SWITCH: 'switch' } },\n      reading: { on: { ACTIVATE: 'activated', BREAK: 'broken', FAILURE: 'failed', STOP: 'stopped' } },\n      writing: { on: { ACTIVATE: 'activated', BREAK: 'broken', FAILURE: 'failed', STOP: 'stopped' } },\n      closed: { on: { FAILURE: 'failed', BREAK: 'broken', CONNECT: 'connected', RECONNECT: 'reconnecting', INIT: 'init', STOP: 'stopped', SWITCH: 'switch' } },\n      failed: { on: { CLOSE: 'closed', BREAK: 'broken', STOP: 'stopped', SWITCH: 'switch' } },\n      switch: { on: { CLOSE: 'closed', BREAK: 'broken', STOP: 'stopped' } },\n      stopped: { on: { NEW: 'new', STOP: 'stopped' } }\n    }\n  })\n}\n\nde.biancoroyal.modbus.core.client.getActualUnitId = function (node, msg) {\n  if (msg.payload && Number.isInteger(msg.payload.unitid)) {\n    return parseInt(msg.payload.unitid)\n  } else if (Number.isInteger(msg.queueUnitId)) {\n    return parseInt(msg.queueUnitId)\n  } else {\n    return parseInt(node.unit_id) || 0\n  }\n}\n\nde.biancoroyal.modbus.core.client.startStateService = function (toggleMachine) {\n  return this.XStateFSM.interpret(toggleMachine).start()\n}\n\nde.biancoroyal.modbus.core.client.checkUnitId = function (unitid, clientType) {\n  if (clientType === 'tcp') {\n    return unitid >= 0 && unitid <= 255\n  } else {\n    return unitid >= 0 && unitid <= 247\n  }\n}\n\nde.biancoroyal.modbus.core.client.getLogFunction = function (node) {\n  if (node.internalDebugLog) {\n    return node.internalDebugLog\n  } else {\n    return de.biancoroyal.modbus.core.client.internalDebug\n  }\n}\n\nde.biancoroyal.modbus.core.client.activateSendingOnSuccess = function (node, cb, cberr, resp, msg) {\n  node.activateSending(msg).then(function () {\n    cb(resp, msg)\n  }).catch(function (err) {\n    cberr(err, msg)\n  }).finally(function () {\n    node.stateService.send('ACTIVATE')\n  })\n}\n\nde.biancoroyal.modbus.core.client.activateSendingOnFailure = function (node, cberr, err, msg) {\n  node.activateSending(msg).then(function () {\n    cberr(err, msg)\n  }).catch(function (err) {\n    cberr(err, msg)\n  }).finally(function () {\n    node.stateService.send('ACTIVATE')\n  })\n}\n\nde.biancoroyal.modbus.core.client.readModbusByFunctionCodeOne = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  if (msg.payload.enableDeformedMessages) {\n    node.client.readCoils_deformedReadEnabled(parseInt(msg.payload.address), parseInt(msg.payload.quantity)).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n      node.modbusErrorHandling(err)\n    })\n  } else {\n    node.client.readCoils(parseInt(msg.payload.address), parseInt(msg.payload.quantity)).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n      node.modbusErrorHandling(err)\n    })\n  }\n}\n\nde.biancoroyal.modbus.core.client.readModbusByFunctionCodeTwo = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  if (msg.payload.enableDeformedMessages) {\n    node.client.readDiscreteInputs_deformedReadEnabled(parseInt(msg.payload.address), parseInt(msg.payload.quantity)).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n      node.modbusErrorHandling(err)\n    })\n  } else {\n    node.client.readDiscreteInputs(parseInt(msg.payload.address), parseInt(msg.payload.quantity)).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n      node.modbusErrorHandling(err)\n    })\n  }\n}\n\nde.biancoroyal.modbus.core.client.readModbusByFunctionCodeThree = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  if (msg.payload.enableDeformedMessages) {\n    node.client.readHoldingRegisters_deformedReadEnabled(parseInt(msg.payload.address), parseInt(msg.payload.quantity)).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n      node.modbusErrorHandling(err)\n    })\n  } else {\n    node.client.readHoldingRegisters(parseInt(msg.payload.address), parseInt(msg.payload.quantity)).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n      node.modbusErrorHandling(err)\n    })\n  }\n}\n\nde.biancoroyal.modbus.core.client.readModbusByFunctionCodeFour = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  if (msg.payload.enableDeformedMessages) {\n    node.client.readInputRegisters_deformedReadEnabled(parseInt(msg.payload.address), parseInt(msg.payload.quantity)).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n      node.modbusErrorHandling(err)\n    })\n  } else {\n    node.client.readInputRegisters(parseInt(msg.payload.address), parseInt(msg.payload.quantity)).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n      node.modbusErrorHandling(err)\n    })\n  }\n}\n\nde.biancoroyal.modbus.core.client.sendCustomFunctionCode = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  // const nodeLog = deb.biancoroyal.modbus.core.client.getLogFunction(node)\n\n  node.client.sendCustomFc(msg.payload.unitid, msg.payload.fc, msg.payload.requestCard, msg.payload.responseCard).then(function (resp) {\n    coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n  }).catch(function (err) {\n    coreClient.activateSendingOnFailure(node, cberr, new Error(err.message), msg)\n    node.modbusErrorHandling(err)\n  })\n}\n\nde.biancoroyal.modbus.core.client.readModbusByFunctionCode = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  const nodeLog = de.biancoroyal.modbus.core.client.getLogFunction(node)\n  switch (parseInt(msg.payload.fc)) {\n    case 1:\n      coreClient.readModbusByFunctionCodeOne(node, msg, cb, cberr)\n      break\n    case 2:\n      coreClient.readModbusByFunctionCodeTwo(node, msg, cb, cberr)\n      break\n    case 3:\n      coreClient.readModbusByFunctionCodeThree(node, msg, cb, cberr)\n      break\n    case 4:\n      coreClient.readModbusByFunctionCodeFour(node, msg, cb, cberr)\n      break\n    default:\n      coreClient.activateSendingOnFailure(node, cberr, new Error('Function Code Unknown'), msg)\n      nodeLog('Function Code Unknown %s', msg.payload.fc)\n      break\n  }\n}\n\nde.biancoroyal.modbus.core.client.customModbusMessage = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  const nodeLog = de.biancoroyal.modbus.core.client.getLogFunction(node)\n  let delayTime = 1\n\n  if (!node.client) {\n    nodeLog('Client Not Ready As Object On Reading Modbus')\n    return\n  }\n\n  if (node.client._port && node.client._port._client && !node.client._port._client.readable) {\n    if (!node.connectClient()) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error('Modbus-Read Error from client connecting'), msg)\n      return\n    }\n    delayTime = 500\n  }\n\n  setTimeout(function () {\n    if (!node.bufferCommands) {\n      if (node.clienttype !== 'tcp') {\n        node.stateService.send('READ')\n      }\n    } else {\n      node.queueLog(JSON.stringify({\n        info: 'read msg via Modbus',\n        message: msg.payload,\n        queueUnitId: msg.queueUnitId,\n        timeout: node.client.getTimeout(),\n        state: node.actualServiceState.value\n      }))\n    }\n\n    node.setUnitIdFromPayload(msg)\n    node.client.setTimeout(node.clientTimeout)\n\n    try {\n      coreClient.sendCustomFunctionCode(node, msg, cb, cberr)\n    } catch (err) {\n      coreClient.activateSendingOnFailure(node, cberr, err, msg)\n      nodeLog(err.message)\n      node.modbusErrorHandling(err)\n    }\n  }, delayTime)\n}\n\nde.biancoroyal.modbus.core.client.readModbus = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  const nodeLog = de.biancoroyal.modbus.core.client.getLogFunction(node)\n  let delayTime = 1\n\n  if (!node.client) {\n    nodeLog('Client Not Ready As Object On Reading Modbus')\n    return\n  }\n\n  if (node.client._port && node.client._port._client && !node.client._port._client.readable) {\n    if (!node.connectClient()) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error('Modbus-Read Error from client connecting'), msg)\n      return\n    }\n    delayTime = 500\n  }\n\n  setTimeout(function () {\n    if (!node.bufferCommands) {\n      if (node.clienttype !== 'tcp') {\n        node.stateService.send('READ')\n      }\n    } else {\n      node.queueLog(JSON.stringify({\n        info: 'read msg via Modbus',\n        message: msg.payload,\n        queueUnitId: msg.queueUnitId,\n        timeout: node.client.getTimeout(),\n        state: node.actualServiceState.value\n      }))\n    }\n\n    node.setUnitIdFromPayload(msg)\n    node.client.setTimeout(node.clientTimeout)\n\n    try {\n      coreClient.readModbusByFunctionCode(node, msg, cb, cberr)\n    } catch (err) {\n      coreClient.activateSendingOnFailure(node, cberr, err, msg)\n      nodeLog(err.message)\n      node.modbusErrorHandling(err)\n    }\n  }, delayTime)\n}\n\nde.biancoroyal.modbus.core.client.writeModbusByFunctionCodeFive = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  if (msg.payload.value) {\n    msg.payload.value = true\n  } else {\n    msg.payload.value = false\n  }\n  node.client.writeCoil(parseInt(msg.payload.address), msg.payload.value).then(function (resp) {\n    coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n  }).catch(function (err) {\n    if (node.client.getID() === 0) {\n      const resp = {\n        address: parseInt(msg.payload.address),\n        value: parseInt(msg.payload.value)\n      }\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    } else {\n      coreClient.activateSendingOnFailure(node, cberr, err, msg)\n      node.modbusErrorHandling(err)\n    }\n  })\n}\n\nde.biancoroyal.modbus.core.client.writeModbusByFunctionCodeFifteen = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  if (parseInt(msg.payload.value.length) !== parseInt(msg.payload.quantity)) {\n    coreClient.activateSendingOnFailure(node, cberr, new Error('Quantity should be less or equal to coil payload array length: ' +\n      msg.payload.value.length + ' Addr: ' + msg.payload.address + ' Q: ' + msg.payload.quantity), msg)\n  } else {\n    node.client.writeCoils(parseInt(msg.payload.address), msg.payload.value).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      if (node.client.getID() === 0) {\n        const resp = {\n          address: parseInt(msg.payload.address),\n          value: parseInt(msg.payload.value)\n        }\n        coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n      } else {\n        coreClient.activateSendingOnFailure(node, cberr, err, msg)\n        node.modbusErrorHandling(err)\n      }\n    })\n  }\n}\n\nde.biancoroyal.modbus.core.client.writeModbusByFunctionCodeSix = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  node.client.writeRegister(parseInt(msg.payload.address), parseInt(msg.payload.value)).then(function (resp) {\n    coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n  }).catch(function (err) {\n    if (node.client.getID() === 0) {\n      const resp = {\n        address: parseInt(msg.payload.address),\n        value: parseInt(msg.payload.value)\n      }\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    } else {\n      coreClient.activateSendingOnFailure(node, cberr, err, msg)\n      node.modbusErrorHandling(err)\n    }\n  })\n}\n\nde.biancoroyal.modbus.core.client.writeModbusByFunctionCodeSixteen = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  if (parseInt(msg.payload.value.length) !== parseInt(msg.payload.quantity)) {\n    coreClient.activateSendingOnFailure(node, cberr, new Error('Quantity should be less or equal to register payload array length: ' +\n      msg.payload.value.length + ' Addr: ' + msg.payload.address + ' Q: ' + msg.payload.quantity), msg)\n  } else {\n    node.client.writeRegisters(parseInt(msg.payload.address), msg.payload.value).then(function (resp) {\n      coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n    }).catch(function (err) {\n      if (node.client.getID() === 0) {\n        const resp = {\n          address: parseInt(msg.payload.address),\n          value: parseInt(msg.payload.value)\n        }\n        coreClient.activateSendingOnSuccess(node, cb, cberr, resp, msg)\n      } else {\n        coreClient.activateSendingOnFailure(node, cberr, err, msg)\n        /* istanbul ignore next */\n        node.modbusErrorHandling(err)\n      }\n    })\n  }\n}\n\nde.biancoroyal.modbus.core.client.writeModbus = function (node, msg, cb, cberr) {\n  const coreClient = de.biancoroyal.modbus.core.client\n  const nodeLog = de.biancoroyal.modbus.core.client.getLogFunction(node)\n  let delayTime = 1\n  if (!node.client) {\n    nodeLog('Client Not Ready As Object On Writing Modbus')\n    return\n  }\n\n  if (node.client._port && node.client._port._client && !node.client._port._client.writable) {\n    if (!node.connectClient()) {\n      coreClient.activateSendingOnFailure(node, cberr, new Error('Modbus-Read Error from client connecting'), msg)\n      return\n    }\n    /* istanbul ignore next */\n    delayTime = 500\n  }\n\n  setTimeout(function () {\n    if (!node.bufferCommands) {\n      if (node.clienttype !== 'tcp') {\n        node.stateService.send('WRITE')\n      }\n    } else {\n      node.queueLog(JSON.stringify({\n        info: 'write msg',\n        message: msg.payload,\n        queueUnitId: msg.queueUnitId,\n        timeout: node.client.getTimeout(),\n        state: node.actualServiceState.value\n      }))\n    }\n\n    node.setUnitIdFromPayload(msg)\n    node.client.setTimeout(node.clientTimeout)\n\n    try {\n      switch (parseInt(msg.payload.fc)) {\n        case 15: // FC: 15\n          coreClient.writeModbusByFunctionCodeFifteen(node, msg, cb, cberr)\n          break\n        case 5: // FC: 5\n          coreClient.writeModbusByFunctionCodeFive(node, msg, cb, cberr)\n          break\n        case 16: // FC: 16\n          coreClient.writeModbusByFunctionCodeSixteen(node, msg, cb, cberr)\n          break\n        case 6: // FC: 6\n          coreClient.writeModbusByFunctionCodeSix(node, msg, cb, cberr)\n          break\n        default:\n          coreClient.activateSendingOnFailure(node, cberr, new Error('Function Code Unknown'), msg)\n          nodeLog('Function Code Unknown %s', msg.payload.fc)\n          break\n      }\n    } catch (err) {\n      coreClient.activateSendingOnFailure(node, cberr, err, msg)\n      nodeLog(err.message)\n    }\n  }, delayTime)\n}\n\nde.biancoroyal.modbus.core.client.setNewTCPNodeSettings = function (node, msg) {\n  node.clienttype = 'tcp'\n  node.tcpHost = msg.payload.tcpHost || node.tcpHost\n  node.tcpPort = msg.payload.tcpPort || node.tcpPort\n  node.tcpType = msg.payload.tcpType || node.tcpType\n}\n\nde.biancoroyal.modbus.core.client.setNewSerialNodeSettings = function (node, msg) {\n  if (msg.payload.serialPort) {\n    node.serialPort = msg.payload.serialPort || node.serialPort\n  }\n\n  if (msg.payload.serialBaudrate) {\n    node.serialBaudrate = parseInt(msg.payload.serialBaudrate) || node.serialBaudrate\n  }\n\n  node.clienttype = 'serial'\n  node.serialDatabits = msg.payload.serialDatabits || node.serialDatabits\n  node.serialStopbits = msg.payload.serialStopbits || node.serialStopbits\n  node.serialParity = msg.payload.serialParity || node.serialParity\n  node.serialType = msg.payload.serialType || node.serialType\n\n  // Make sure is parsed when string, otherwise just assign.\n  if (msg.payload.serialAsciiResponseStartDelimiter && typeof msg.payload.serialAsciiResponseStartDelimiter === 'string') {\n    node.serialAsciiResponseStartDelimiter = parseInt(msg.payload.serialAsciiResponseStartDelimiter, 16)\n  } else {\n    node.serialAsciiResponseStartDelimiter = msg.payload.serialAsciiResponseStartDelimiter || node.serialAsciiResponseStartDelimiter\n  }\n\n  if (msg.payload.serialConnectionDelay) {\n    node.serialConnectionDelay = parseInt(msg.payload.serialConnectionDelay) || node.serialConnectionDelay\n  }\n}\n\nde.biancoroyal.modbus.core.client.setNewNodeOptionalSettings = function (node, msg) {\n  const nodeLog = de.biancoroyal.modbus.core.client.getLogFunction(node)\n\n  try {\n    let unitId = parseInt(msg.payload.unitId)\n    if (!node.checkUnitId(unitId, node.clienttype)) {\n      unitId = node.unit_id\n    }\n    node.unit_id = unitId\n  } catch (err) {\n    nodeLog(err.message)\n  }\n\n  if (msg.payload.commandDelay) {\n    node.commandDelay = parseInt(msg.payload.commandDelay) || node.commandDelay\n  }\n\n  if (msg.payload.clientTimeout) {\n    node.clientTimeout = parseInt(msg.payload.clientTimeout) || node.clientTimeout\n  }\n\n  if (msg.payload.reconnectTimeout) {\n    node.reconnectTimeout = parseInt(msg.payload.reconnectTimeout) || node.reconnectTimeout\n  }\n}\n\nde.biancoroyal.modbus.core.client.setNewNodeSettings = function (node, msg) {\n  const nodeLog = de.biancoroyal.modbus.core.client.getLogFunction(node)\n  const coreClient = de.biancoroyal.modbus.core.client\n\n  if (!msg) {\n    nodeLog('New Connection message invalid.')\n    return false\n  }\n\n  switch (msg.payload.connectorType.toUpperCase()) {\n    case 'TCP':\n      coreClient.setNewTCPNodeSettings(node, msg)\n      nodeLog('New Connection TCP Settings ' + node.tcpHost + ' ' + node.tcpPort + ' ' + node.tcpType)\n      break\n\n    case 'SERIAL':\n      coreClient.setNewSerialNodeSettings(node, msg)\n      nodeLog('New Connection Serial Settings ' + node.serialPort + ' ' + node.serialBaudrate + ' ' + node.serialType)\n      break\n\n    default:\n      nodeLog('Unknown Dynamic Reconnect Type ' + msg.payload.connectorType)\n  }\n\n  coreClient.setNewNodeOptionalSettings(node, msg)\n\n  return true\n}\n\nde.biancoroyal.modbus.core.client.messageAllowedStates = ['activated', 'queueing', 'sending', 'empty', 'connected']\n\nmodule.exports = de.biancoroyal.modbus.core.client\n"]}